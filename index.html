<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>timjrw | Show Reels</title>
  <style>
    :root{ --gap:18px; --radius:14px; --text:#111; --muted:#666; --card:#f4f4f4; }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:#fff;
    }
    header{ max-width:1100px; margin:0 auto; padding:44px 20px 10px; }
    h1{ margin:0 0 6px; font-size:22px; }
    p{ margin:0; color:var(--muted); }
    main{ max-width:1100px; margin:0 auto; padding:18px 20px 52px; }

    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; margin-top:10px;
    }
    .filters{ display:flex; gap:12px; flex-wrap:wrap; margin-top: 14px; }
    .btn{
      border:0; background:#eee; color:#111;
      padding:7px 10px; border-radius:999px; cursor:pointer;
      font-size:12px;
    }
    .btn.active{ background:#111; color:#fff; }

    .section{ margin-top: 26px; }
    .section:first-child{ margin-top: 14px; }
    .section-head{
      display:flex; align-items:baseline; justify-content:space-between;
      gap:12px; margin: 0 0 12px;
    }
    .section-title{ margin:0; font-size:15px; letter-spacing:.2px; }
    .section-note{ margin:0; font-size:12px; color:var(--muted); }

    .grid{
      display:grid;
      grid-template-columns:repeat(3, minmax(0, 1fr));
      gap:var(--gap);
    }
    @media (max-width: 920px){ .grid{ grid-template-columns:repeat(2, 1fr); } }
    @media (max-width: 820px){ .grid{ grid-template-columns:1fr; } }
    @media (max-width: 640px){
  :root{ --gap: 14px; }
  .meta{ padding-top: 12px; }
  .title{ font-size: 15px; line-height: 1.4; }
}

    .item{ text-decoration:none; color:inherit; display:block; }
    .thumb{
      position:relative;
      width:100%;
      aspect-ratio:16/9;
      border-radius:var(--radius);
      overflow:hidden;
      background:var(--card);
    }
    .thumb img, .thumb .player{
      position:absolute; inset:0;
      width:100%; height:100%;
    }
    .thumb img{ object-fit:cover; transition:opacity 160ms ease; }
    .thumb.is-playing img{ opacity:0; }
    .thumb .player{ opacity:0; transition:opacity 160ms ease; }
    .thumb.is-playing .player{ opacity:1; }

    .thumb::after{
      content:"";
      position:absolute; inset:0;
      box-shadow: 0 0 0 1px rgba(0,0,0,.08) inset;
      border-radius:var(--radius);
      pointer-events:none;
    }
    .meta{ padding:10px 2px 0; }
    .title{ font-weight: 430; letter-spacing: 0.01em; }
    .sub{ letter-spacing: 0.08em; text-transform: uppercase; font-size: 11px; color: rgba(0,0,0,.45); }

    .badge{
      position:absolute; left:10px; top:10px;
      font-size:11px; padding:6px 8px; border-radius:999px;
      background:rgba(0,0,0,.65); color:#fff; z-index:2;
    }
    .hero-name {
      font-size: 34px;
      font-weight: 600;
      letter-spacing: -0.02em;
      margin: 0;
    }

    .hero-role {
      margin: 6px 0 0;
      font-size: 14px;
      color: #666;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

.hero-note {
  margin-top: 10px;
  font-size: 12px;
  color: #888;
  max-width: 520px;
}
.hero--art .hero-role{
  margin: 10px 0 0;
  font-size: 12px;
  color: rgba(0,0,0,.55);
  letter-spacing: 0.22em;
  text-transform: uppercase;
}
.hero--art .hero-note{
  margin-top: 16px;
  padding-bottom: 18px;
  font-size: 12px;
  color: rgba(0,0,0,.45);
  max-width: 520px;
  line-height: 1.7;
}
    @media (max-width: 640px){
  header{ padding: 28px 16px 8px; }
  main{ padding: 14px 16px 44px; }

  .topbar{
    flex-direction: column;
    align-items: flex-start;
    gap: 14px;
    margin-top: 0;
  }

  .filters{
    width: 100%;
    gap: 10px;
  }

  .btn{
    padding: 10px 12px;
    font-size: 13px;
  }
}
    @media (hover: none) and (pointer: coarse){
  .yt-hover::before{
    content: "Tap to preview";
    position: absolute;
    right: 10px;
    bottom: 10px;
    font-size: 11px;
    padding: 6px 8px;
    border-radius: 999px;
    background: rgba(0,0,0,.55);
    color: #fff;
    z-index: 2;
  }
}
    @media (max-width: 640px){
  .filters{
    position: sticky;
    top: 10px;
    padding: 10px 0;
    background: rgba(255,255,255,.92);
    backdrop-filter: blur(8px);
    z-index: 5;
  }
}
  </style>
</head>
<body>
  <header>
    <div class="hero--art">
        <h1 class="hero-name">Tim Jirawangso</h1>
        <p class="hero-role">Video Editor</p>
      </div>
      <div class="filters" aria-label="filters">
        <button class="btn active" data-filter="all">All</button>
        <button class="btn" data-filter="commercial">Ads / Shorts</button>
        <button class="btn" data-filter="mv">MV</button>
      </div>
    </div>
  </header>

  <main id="app"></main>

  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    const DATA_URL = "data/projects.json";

    // ---------- Render ----------
    function cardHTML(item) {
      if (item.platform === "youtube") {
        const href = `https://youtu.be/${item.id}`;
        return `
          <a class="item" href="${href}" target="_blank" rel="noopener">
            <div class="thumb yt-hover" data-video="${item.id}">
              <img alt="${escapeHtml(item.title)}" loading="lazy">
              <div class="player"></div>
            </div>
            <div class="meta">
              <p class="title">${escapeHtml(item.title)}</p>
              <p class="sub">YouTube</p>
            </div>
          </a>
        `;
      }

      // Instagram (ภาพนิ่ง + ลิงก์ออกไป)
      const thumb = item.cover
  ? item.cover
  : getYoutubeThumbnail(item.id);

      return `
        <a class="item" href="${item.url}" target="_blank" rel="noopener">
          <div class="thumb">
  <img src="${thumb}" alt="${item.title}">
</div>
          <div class="meta">
            <p class="title">${escapeHtml(item.title)}</p>
            <p class="sub">Instagram</p>
          </div>
        </a>
      `;
    }

    function sectionHTML(title, note, items) {
      return `
        <section class="section">
          <div class="section-head">
            <h2 class="section-title">${escapeHtml(title)}</h2>
            <p class="section-note">${escapeHtml(note)}</p>
          </div>
          <div class="grid">
            ${items.map(cardHTML).join("")}
          </div>
        </section>
      `;
    }

    function render(appEl, data, filter) {
      const filtered = (filter === "all") ? data : data.filter(x => x.category === filter);

      const mv = filtered.filter(x => x.category === "mv");
      const commercial = filtered.filter(x => x.category === "commercial");

      appEl.innerHTML = [
  commercial.length ? sectionHTML("Commercial / Shorts", "Ads / Branded Content", commercial) : "",
  mv.length ? sectionHTML("MV", "Music Videos", mv) : ""
].join("");

      // ตั้งรูปปก YouTube thumbnail
      document.querySelectorAll(".yt-hover").forEach(el => {
        const id = el.dataset.video;
        const img = el.querySelector("img");
        img.src = `https://i.ytimg.com/vi/${id}/hqdefault.jpg`;
      });

      // หลัง render เสร็จ ค่อย bind hover (ถ้า API พร้อมแล้ว)
      if (window.__YT_READY__) {
        bindHover();
      }
    }

    // ---------- YouTube Hover Preview ----------
    const players = new Map(); // el -> YT.Player

    function ensurePlayer(el) {
      if (players.has(el)) return players.get(el);
      const id = el.dataset.video;
      const mount = el.querySelector(".player");

      const player = new YT.Player(mount, {
        videoId: id,
        playerVars: {
          autoplay: 0,
          controls: 0,
          modestbranding: 1,
          rel: 0,
          playsinline: 1
        },
        events: {
          onReady: (e) => e.target.mute()
        }
      });

      players.set(el, player);
      return player;
    }

    function play(el) {
      el.classList.add("is-playing");
      const p = ensurePlayer(el);

      // loop แบบเนียน: ใกล้จบแล้ว seek กลับ
      if (!el._loopTimer) {
        el._loopTimer = setInterval(() => {
          try {
            const dur = p.getDuration?.() || 0;
            const cur = p.getCurrentTime?.() || 0;
            if (dur && cur > dur - 0.25) p.seekTo(0, true);
          } catch {}
        }, 200);
      }

      // บางที player ยังไม่พร้อมทันที → ลองซ้ำสั้นๆ
      let tries = 0;
      const t = setInterval(() => {
        tries++;
        try {
          if (p?.playVideo) {
            p.mute();
            p.playVideo();
            clearInterval(t);
          }
        } catch {}
        if (tries > 20) clearInterval(t);
      }, 50);
    }

    function stop(el) {
      const p = players.get(el);
      if (p?.pauseVideo) {
        try { p.pauseVideo(); } catch {}
      }
      el.classList.remove("is-playing");
      if (el._loopTimer) {
        clearInterval(el._loopTimer);
        el._loopTimer = null;
      }
    }

    function bindHover() {
      document.querySelectorAll(".yt-hover").forEach(el => {
        if (el.__bound) return;
        el.__bound = true;

        el.addEventListener("mouseenter", () => play(el));
        el.addEventListener("mouseleave", () => stop(el));

        // มือถือ: แตะครั้งแรก = preview สั้นๆ (กันเด้งไปลิงก์ทันที)
        el.addEventListener("touchstart", (ev) => {
          if (!el.classList.contains("is-playing")) {
            ev.preventDefault();
            play(el);
            setTimeout(() => stop(el), 2000);
          }
        }, { passive: false });
      });
    }

    // YouTube API callback
    window.onYouTubeIframeAPIReady = () => {
      window.__YT_READY__ = true;
      bindHover();
    };

    // ---------- Init ----------
    const app = document.getElementById("app");
    let projects = [];
    let currentFilter = "all";

    function escapeHtml(str) {
      return String(str ?? "").replace(/[&<>"']/g, s => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[s]));
    }

    fetch(DATA_URL)
      .then(r => r.json())
      .then(data => {
        projects = data;
        render(app, projects, currentFilter);
      })
      .catch(err => {
        app.innerHTML = `<p style="color:#b00">โหลดข้อมูลไม่สำเร็จ: ${escapeHtml(err.message)}</p>`;
      });

    // filter buttons
    document.querySelectorAll(".btn[data-filter]").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelector(".btn.active")?.classList.remove("active");
        btn.classList.add("active");
        currentFilter = btn.dataset.filter;
        render(app, projects, currentFilter);
      });
    });
  </script>
</body>
</html>
